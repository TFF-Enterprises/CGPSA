<?xml version="1.1" encoding="iso-8859-1"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN" "xhtml11.dtd">
<!-- $Id$ -->
<html xml:lang="en" xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1" />
<title>CGPSA - A Spam Filter for CommuniGate&reg; Pro</title>
<link rel="stylesheet" href="style.css" type="text/css" media="screen" />
</head>
<body>
<h1>CGPSA - A Spam Filter for <a href="http://www.stalker.com/CommuniGatePro/">CommuniGate&reg; Pro</a><br/>Version 1.0.1</h1>
<h2>Copyright &copy; 2002-2003 TFF Enterprises<br/>
Written by <a href="http://www.tffenterprises.com/~dmz/">Daniel M. Zimmerman</a><br/>
All Rights Reserved</h2>

<p>CGPSA works in concert with <a
href="http://www.spamassassin.org/">SpamAssassin</a>&trade; software
to scan email messages distributed by a <a
href="http://www.stalker.com/CommuniGatePro/">CommuniGate&reg;
Pro</a> server. The filter works efficiently, by directly using
the SpamAssassin API. It does not rely on a daemon process such as
spamd or on the execution of shell scripts (as the usual process for
utilizing SpamAssassin with CommuniGate servers does). It can safely
be used with multiple CommuniGate Pro enqueuer threads.</p>

<p>CGPSA supports all features of SpamAssassin, including such
functionality as the use of <a
href="http://razor.sourceforge.net/">Razor</a>, <a
href="http://www.rhyolite.com/anti-spam/dcc/">DCC</a>, Bayesian
learning (with SpamAssassin 2.5 or higher), and auto-whitelists. All
these features are controlled through SpamAssassin's regular
configuration files. For more information on SpamAssassin features and
configuration, see the SpamAssassin <a
href="http://www.spamassassin.org/doc.html">documentation</a>.</p>

<h3>Downloads</h3>
<p>The most current (release) version of CGPSA can always be downloaded from <a href="http://www.tffenterprises.com/cgpsa/cgpsa.tgz">http://www.tffenterprises.com/cgpsa/cgpsa.tgz</a>. The current (release) version is 1.0.1, released 27 March 2003.</p>
<p>There is no beta version available at this time.</p>

<h2>Documentation</h2>

<p>This documentation consists of the following sections:</p>

<ul>
<li><a href="#overview">Overview</a></li>
<li><a href="#installation">Installation</a></li>
<li><a href="#license">License and Fees</a></li>
<li><a href="#bugs">Bugs Reports, Feature Requests and the Like</a></li>
<li><a href="#history">Revision History</a></li>
<li><a href="#future">Future Plans</a></li>
<li><a href="#legal">Legal Stuff</a></li>
</ul>

<hr/>

<h3 id="overview">Overview</h3>

<p>CGPSA has two basic operating modes, "<a
href="#overview:fullfeatured">full-featured</a>" and "<a
href="#overview:headersonly">headers-only</a>".</p>

<h4 id="overview:fullfeatured">Full-Featured Mode</h4>

<p>Full-featured mode uses CommuniGate Pro's PIPE functionality to
resubmit messages to the server after scanning, and can also use the
CommuniGate Pro CLI to determine information about message
recipients. In this mode, email is scanned only for the recipients on
the local system, and email for remote systems is always left
unaltered. This is good, because SpamAssassin headers added according
to your local policy may interfere with the spam filtering policy of a
remote system. If a particular message is destined for both local and
remote users, the local users receive a scanned copy and the remote
users an unaltered one. Scanned email is treated exactly as
SpamAssassin would treat it; for instance, if the SpamAssassin
preferences say to rewrite the subject line of spam, a scanned spam
will have a rewritten subject line. </p>

<p>Other advanced functionality, such as the use of individual
SpamAssassin preference files and state files for particular users
(e.g. auto-whitelist, Bayes database), is available in full-featured
mode. At this time, there is no user interface to configure individual
SpamAssassin preferences; however, system administrators with access
to the CommuniGate Pro directory may take advantage of these features
for their own use. Individual user preferences are located in a
<code>.spamassassin</code> directory inside the CommuniGate Pro
account directory corresponding to the account
(<code>username.macnt</code>).</p>


<h4 id="overview:headersonly">Headers-Only Mode</h4>

<p>Headers-only mode does not use CommuniGate Pro's CLI or PIPE
functionality. Instead, it adds headers to messages directly through
CommuniGate's external filter interface. This has the benefit of being
more efficient than using PIPE, because it does not require
resubmission and reprocessing of messages. However, it also eliminates
much of the advanced functionality, such as the use of individual
preference and state files, and the ability to distribute unaltered
messages to remote servers.</p>

<hr/>

<h3 id="installation">Installation</h3>

<p>Installation of CGPSA takes several steps. The following
step-by-step instructions should enable you to get the filter working
on your system. If you can't get it working, ask for help (as
described below in <a href="#bugs">Bug Reports, Feature Requests and
the Like</a>).</p>

<p>Note that CGPSA has not been tested on Windows - not even a little
bit. I have no idea if it will work, or how these steps will have to
be changed in order to install it on Windows. If anybody tries -
especially if anybody succeeds - please let me know what happens and
how you installed it, so I can incorporate that information to a
future version of this documentation.</p>

<ol>

<li>Install SpamAssassin on your system. The way to do this is
platform dependent - on FreeBSD, for example, you might use the
FreeBSD Ports system. Also install any auxiliary programs you want
SpamAssassin to use, such as Razor and DCC. <a
href="http://www.cpan.org/">Perl</a> is a prerequisite for
SpamAssassin.<br/><br/></li>

<li>Verify that the path in the first line of the <code>cgpsa</code>
script points to the Perl executable on your system. If you have Perl
in a different location (such as <code>/usr/local/bin/perl</code> or
<code>/opt/bin/perl</code>), change the line accordingly.<br/><br/></li>

<li>Verify that the <code>$cgp_base</code> variable (listed under
"Customizable Variables" near the top of the <code>cgpsa</code>
script) contains the correct path to your CommuniGate Pro Base
Directory (hereafter referred to as "CommuniGate directory"). The
default path is <code>/var/CommuniGate</code> on most systems.<br/><br/></li>

<li>Install the <code>cgpsa</code> script inside your CommuniGate
directory, and make sure it is executable. You can create a new
subdirectory for it, or just put it at the top level; it doesn't
really matter where it is, but make sure you know the full path to it
(<code>/var/CommuniGate/cgpsa</code>, if it is at the top level of a
default CommuniGate directory) - you'll need the path
later.<br/><br/></li>

<li>Install the <code>cgpsa.conf</code> configuration file into the
<code>Settings</code> subdirectory of your CommuniGate
directory. Modify any of the settings you want to change - they are
all well documented in the configuration file itself.<br/><br/></li>

<li>If you are running CGPSA in its full-featured mode with CLI usage enabled, you must install the <a href="http://www.stalker.com/CGPerl/">CommuniGate Pro CLI Perl Module</a>, <code>CLI.pm</code>. A version of <code>CLI.pm</code> is included with the CGPSA distribution. You can copy it to any of your system's Perl @INC directories, or just place it in the directory where you've installed <code>cgpsa</code>. <code>CLI.pm</code> requires the <a href="http://search.cpan.org/search?module=Digest::MD5">Digest::MD5</a> Perl module; if you do not have it installed on your system, download and install it (or use the <a href="http://www.cpan.org/">CPAN</a> module to install it). If you have installed other scripts on your system that require the CommuniGate Pro CLI, you may already have installed <code>CLI.pm</code>; you do not need to reinstall it for CGPSA, though you should ensure that it's a recent version. If you are running in headers-only mode, or in full-featured mode without the CLI, you need not install <code>CLI.pm</code> for CGPSA to function.<br/><br/></li>

<li>If you are running CGPSA in its full-featured mode with CLI usage
enabled, you must create a CommuniGate Pro account with PWD access (as
described in the configuration file). Use the username and password
specified in your <code>cgpsa.conf</code>. Enable a sufficient number
of PWD connections for the number of enqueuer threads used by your
server. See the configuration file for details. If you are running in headers-only mode, or in full-featured mode without the CLI, you need not install the CLI module.<br/><br/></li>

<li>Create the "default home directory", whose path is set in the
configuration file (<code>cgpsa.conf</code>). This is where the
default SpamAssassin preferences and state files will be stored - that
is, those that are used in the absence of individual user
preferences.<br/><br/></li>

<li>Create a SpamAssassin configuration in the default home directory,
if necessary. If the CommuniGate Pro server is the only software on
your system using SpamAssassin, you can just use SpamAssassin's
<code>local.cf</code> file (usually in
<code>/etc/mail/spamassassin/</code>) to set up SpamAssassin's
preferences. Otherwise, create a <code>.spamassassin</code>
subdirectory inside the default home directory, containing a
<code>user_prefs</code> file with the SpamAssassin preferences to be
used by CGPSA.<br/><br/></li>

<li>In the CommuniGate Pro web administration interface, go to the
"Helper Settings" page (under "Settings/General"). In an empty
"Content Filtering" section, enter a name for the filter (such as
"CGPSA"), and the full path to the filter (see step 4). Set the Log
level to "Low Level" (for now). Leave "Time-out" and "Auto-Restart"
set to "Disabled" unless you experience problems with the filter (be
optimistic for the time being). Finally, enable the filter and save
your changes.<br/><br/></li>

<li>Examine the CommuniGate Pro log for the current day, and search
for the string you entered as the filter's name in the previous
step. You should see a line that reads similar to the following: "*
TFF Enterprises CGPSA Filter 1.0.1 Ready". If you do not see this line,
wait a few seconds and look again. If you still do not see it after a
minute or so, something went wrong and there will likely be an error
message in the log. If you can make sense of it and fix the problem,
wonderful; if not, ask for help (as described below in <a
href="#bugs">Bug Reports, Feature Requests and the
Like</a>).<br/><br/></li>

<li>Go to the "Server-Wide Rules" page of the CommuniGate Pro web
administration interface ("Settings/Rules") and create a rule for
CGPSA.  The rule action should be "ExternalFilter CGPSA" (the name you
assigned to the filter two steps ago).  No rule conditions are
necessary for proper operation, but greater efficiency will be
attained with the following conditions: "Any Route is LOCAL*" and
"Header Field is not X-TFF-CGPSA-Filter*" (or whatever you've changed
the loop prevention header to). Note that omitting the first of these
conditions means that mail distributed to remote servers will be
scanned (which may not be a good idea).</li>

</ol>

<p>If all went well, CGPSA is running and you're done. Send a test
message to yourself and examine its headers to see whether it has been
scanned. You may want to change the log level after running CGPSA for
a while, because it does generate quite a lot of output (it's pretty
interesting output, but if you aren't writing/debugging the filter,
much of it isn't too useful).</p>

<hr/>

<h3 id="disclaimer">Disclaimer</h3>

<p>This is the first public release of CGPSA. As such it is possible
that it contains bugs, although it has already been in use for months
in production systems. Any bugs that might exist in CGPSA are unlikely
to cause the loss of email, because CommuniGate Pro is very
intelligent about how it works with external filters - when a filter
fails, the message stays enqueued. However, it is <em>possible</em>
that email could be lost. There is no warranty, express or implied,
associated with CGPSA; we will not be liable for any lost email. Use
at your own risk.</p>

<hr/>

<h3 id="license">License and Fees</h3>

<p>The final licensing model for CGPSA has not been determined. It has
very similar functionality to some existing commercial products, and
significant effort has been put into it; it would thus be good to
receive something in return. However, charging licensing fees even
remotely similar to those charged for the aforementioned products
makes no sense. Currently, I'm leaning toward some sort of
shareware/donationware model. If you have any suggestions in this
regard (i.e., how much is the filter worth to you?), let me know.</p>

<p>In the meantime, CGPSA is not to be redistributed without explicit
permission. Its source code may not be used in any other products,
in verbatim or modified form, whether or not the product is
open-source. You may of course modify the source code in any way you
like for use on your own system.</p>

<hr/>

<h3 id="bugs">Bug Reports, Feature Requests, and the Like</h3>

<p>Suggestions for feature improvements and bug fixes will gladly be
accepted. There is a mailing list for discussion about this filter,
<code>cgpsa-discuss@tffenterprises.com</code>; this mailing list is
the primary channel for support, discussion of feature requests and
bug fixes, etc. It's a standard CGP mailing list: you can join it by
emailing <a
href="mailto:cgpsa-discuss-on@tffenterprises.com">cgpsa-discuss-on@tffenterprises.com</a>. I
expect it to be pretty low traffic; if you don't want to join the
list, though, send any questions, comments, rants, etc. to <a
href="mailto:cgpsa@tffenterprises.com">cgpsa@tffenterprises.com</a>.</p>

<hr/>

<h3 id="history">Revision History</h3>

<dl>
<dt>1.0.1 - 27 March 2003</dt>
<dd>
<ul>
<li>Added the "install CGP::CLI" step to the installation instructions.</li>
<li>Added runtime check for CGP::CLI module, so that it need not be
installed if CGPSA is running with "use_cli" set to false (or in headers-only mode). The module can be installed as <code>CGP/CLI.pm</code> or just <code>CLI.pm</code>.</li>
</ul>
</dd>
<dt>1.0 - 23 March 2003</dt>
<dd>
<ul>
<li>Initial release version.</li>
</ul>
</dd>
</dl>

<h3 id="future">Future Plans</h3>

<p>I'd like a better name to replace "CGPSA". If
anybody has any suggestions, I'd really appreciate hearing them...</p>

<p>A hypothetical future version of CGPSA will have a user interface
to support individual auto-whitelists, Bayes databases, and
SpamAssassin preferences for CommuniGate users. This hypothetical
version of CGPSA will also be refactored to be somewhat more
object-oriented and modular (because 1000-line Perl scripts are not
the easiest things in the world to maintain).</p>

<hr/>

<h3 id="Legal">Legal Stuff</h3>

<p>CommuniGate is a registered trademark of Stalker Software, Inc. SpamAssassin is a registered trademark of Deersoft, Inc.</p>

<hr/>

<address><a
href="http://validator.w3.org/check/referer"><img
src="http://www.w3.org/Icons/valid-xhtml11" alt="Valid XHTML 1.1!"
height="31" width="88" /></a> Last modified by <a
href="http://www.tffenterprises.com/~dmz/">Daniel M. Zimmerman</a> on 
27 March 2003<br />
</address>
</body>
</html>
